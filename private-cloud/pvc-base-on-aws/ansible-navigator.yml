---

ansible-navigator:
  playbook-artifact:
      save-as: "runs/{playbook_name}-{time_stamp}.json"

  ansible-runner:
    artifact-dir: runs
    rotate-artifacts-count: 3

  logging:
    level: debug
    append: False

  execution-environment:
    container-engine: docker
    enabled: True
    environment-variables:
      pass:
        - AWS_PROFILE
        - CDP_PROFILE
        - SSH_PUBLIC_KEY_FILE
        - CDP_LICENSE_FILE
        - IPA_USER
        - IPA_PASSWORD        
      set:
        ANSIBLE_SSH_CONTROL_PATH: "/dev/shm/cp%%h-%%p-%%r"
        ANSIBLE_CALLBACK_WHITELIST: "ansible.posix.profile_tasks"
        ANSIBLE_GATHERING: "smart"
        ANSIBLE_DEPRECATION_WARNINGS: False
        ANSIBLE_HOST_KEY_CHECKING: False
        ANSIBLE_SSH_RETRIES: 10
        ANSIBLE_COLLECTIONS_PATH: "/mnt/jenright/data/Cloudera/gitRepos/cloudera-labs/ansible_dev/collections:/usr/share/ansible/collections/"
    # image: ghcr.io/cloudera-labs/cldr-runner:pvc-tmp-devel-collections
    image: ghcr.io/cloudera-labs/cldr-runner:aws-latest
    pull:
      arguments:
        - "--tls-verify=false"
    volume-mounts:
      - src: "${ANSIBLE_COLLECTIONS_PATH}"
        dest: "${ANSIBLE_COLLECTIONS_PATH}"
        options: "Z"    
      - src: "${SSH_PUBLIC_KEY_FILE}"
        dest: "${SSH_PUBLIC_KEY_FILE}"
      - src: "${CDP_LICENSE_FILE}"
        dest: "${CDP_LICENSE_FILE}"
      - src: "~/.aws"
        dest: "/runner/.aws"
        options: "Z"
      - src: "~/.ssh"
        dest: "/runner/.ssh"
        options: "Z"
    container-options:
      - "--network=host"
